## 数据库设计

### 数据表三范式

#### 第一范式

**任何表必须有==主键==, 且字段原子化==不可再分==**

**错误示例:**

| 姓名 | 性别 | 联系方式                     |
| ---- | ---- | ---------------------------- |
| 张三 | 男   | zhangsan@qq.com, 13073625764 |
| 李四 | 男   | lisi@qq.com, 18473678735     |
| 王五 | 女   | wangwu@qq.com, 17563875639   |

**正确示例:**

| 编号(主键) | 姓名 | 性别 | 邮箱            | 手机号      |
| ---------- | ---- | ---- | --------------- | ----------- |
| 1          | 张三 | 男   | zhangsan@qq.com | 13073625764 |
| 2          | 李四 | 男   | lisi@qq.com     | 18473678735 |
| 3          | 王五 | 女   | wangwu@qq.com   | 17563875639 |

#### 第二范式

**必须满足第一范式, 所有非主键字段完全依赖主键, ==不能产生部分依赖==**

**错误示例:**

| 学生编号(主键) | 学生姓名 | 学生性别 | 联系方式    | 教师姓名 | 教师电话    |
| -------------- | -------- | -------- | ----------- | -------- | ----------- |
| 0001           | 张三     | 男       | 13073625764 | 张老师   | 13867647098 |
| 0002           | 李四     | 男       | 18473678735 | 李老师   | 13982045690 |
| 0003           | 王五     | 女       | 17563875639 | 张老师   | 13867647098 |
| 0001           | 张三     | 男       | 13073625764 | 王老师   | 17849378902 |
| 0003           | 王五     | 女       | 17563875639 | 李老师   | 13982045690 |

> **产生了数据冗余**

**正确示例:**

- **学生表**

| 学生编号(主键) | 学生姓名 | 学生性别 | 联系方式    |
| -------------- | -------- | -------- | ----------- |
| 0001           | 张三     | 男       | 13073625764 |
| 0002           | 李四     | 男       | 18473678735 |
| 0003           | 王五     | 女       | 17563875639 |

- **教师表**

| 教师编号(主键) | 教师姓名 | 教师性别 | 教师电话    |
| -------------- | -------- | -------- | ----------- |
| 1              | 张老师   | 男       | 13867647098 |
| 2              | 李老师   | 女       | 13982045690 |
| 3              | 王老师   | 男       | 17849378902 |

- **关系表**

| 编号(主键) | 学生编号(外键) | 教师编号(外键) |
| ---------- | -------------- | -------------- |
| 1          | 0001           | 1              |
| 2          | 0001           | 3              |
| 3          | 0002           | 2              |
| 4          | 0003           | 1              |
| 5          | 0003           | 2              |

#### 第三范式

**必须满足第二范式, 所有非主键字段直接依赖主键,==不能产生传递依赖==**

**正确示例: **

- **班级表**

| 班级编号(主键) | 班级名称 |
| -------------- | -------- |
| 1              | 一班     |
| 2              | 二班     |

 - **学生表**

| 学生编号(主键) | 学生姓名 | 学生性别 | 联系方式    | 班级编号(外键) |
| -------------- | -------- | -------- | ----------- | -------------- |
| 0001           | 张三     | 男       | 13073625764 | 1              |
| 0002           | 李四     | 男       | 18473678735 | 2              |
| 0003           | 王五     | 女       | 17563875639 | 1              |
| 0004           | 赵六     | 女       | 13056728670 | 2              |

> **数据表关联数量越多, 速度越慢, 所以为了提升数据库的性能, 可以适当的添加一些重复字段(数据冗余)**

### 数据表关系

#### 一对一

**一个用户对应一个手机号**

- **登录表**

| ID(主键) | 用户名   | 密码   |
| -------- | -------- | ------ |
| 1        | ZhangSan | 123456 |
| 2        | LiSi     | 456789 |

- **用户信息表**

**主键共享**

| ID(主键+外键) | 昵称 | 手机号      | 性别 |
| ------------- | ---- | ----------- | ---- |
| 1             | 张三 | 13073625764 | 男   |
| 2             | 李四 | 18473678735 | 男   |

**外键唯一**

| ID(主键) | 昵称 | 手机号      | 性别 | userId(外键+唯一约束) |
| -------- | ---- | ----------- | ---- | --------------------- |
| 1        | 张三 | 13073625764 | 男   | 1                     |
| 2        | 李四 | 18473678735 | 男   | 2                     |

#### 一对多

**两张表, 多的表加外键**

**一个学生只有一个班级，一个班级有多个学生**

- **学生表**

| ID(主键) | 姓名 | classId(外键) |
| -------- | ---- | ------------- |
| 1        | 张三 | 1             |
| 2        | 李四 | 1             |
| 3        | 五五 | 2             |

- **班级表**

| classId(主键) | 课程名 |
| ------------- | ------ |
| 1             | 一班   |
| 2             | 二班   |

#### 多对多

**三张表, 关系表两个外键**

**一个学生有多个课程，一个课程也有多个学生**

- **学生表**

| studentId(主键) | 姓名 | 性别 |
| --------------- | ---- | ---- |
| 1               | 张三 | 男   |
| 2               | 李四 | 女   |
| 3               | 五五 | 男   |

- **课程表**

| ID(主键) | 课程名 | 时间   |
| -------- | ------ | ------ |
| 1        | 语文   | 10：00 |
| 2        | 数学   | 11：00 |

- **关系表**

| ID(主键) | studentId(外键) | 课程编号(外键) |
| -------- | --------------- | -------------- |
| 1        | 1               | 1              |
| 2        | 1               | 2              |
| 3        | 2               | 2              |
| 4        | 3               | 1              |
| 5        | 3               | 2              |

### 命名规范

#### 库名命名

- **采用英文字母(区分大小写)和0-9的自然数加上下划线组成**
- **命名简洁明确，多个单词用下划线分隔**
- **一个项目一个数据库，多个项目慎用同一个数据库**
- **全部小写命名**
- **禁止使用数据库关键字**
- **表名称不应该取得太长（不超过三个单词）**
- **用单数形式表示名称**
- **表必须填写描述信息**
- **数据库创建 字符集：utf8mb4、排序规则：utf8mb4_general_ci**

#### 字段名命名

- **使用 `int` 就不要使用`varchar`、`char`**
- **用 `varchar(16)` 就不要使 `varchar(256)`**
- **IP地址使用 `int` 类型**
- **固定长度的类型最好使用 `char`**
- **能使用 `tinyint` 就不要使用`smallint`，`int`**
- **最好给每个字段一个默认值，最好不能为 `null`**

- **字符转化为数字(节约空间、提高查询性能)**

- **避免使用 `NULL` 字段(NULL字段很难查询优化、NULL字段的索引需要额外空间、NULL字段的复合索引无效)**

- **少用 `text` 类型(尽量使用 `varchar` 代替)**

### 数据表设计

- **表必须定义==主键==，默认为`id`，整型自增**
- **`id`字段作为自增主键**
- **建议不使用外键, 数据的完整性靠程序来保证**。
- **多表中的相同列，必须保证列定义一致。**
- **使用InnoDB，字符集：utf8mb4、排序规则：utf8mb4_general_ci。**
- **一般情况下每张表都有着五个字段，追踪数据的来源和修改，并且只能逻辑删除，不能物理删除**

### 优化

- **单表一到两年内数据量超过500w或数据容量超过10G考虑分表，且需要提前考虑历史数据迁移或应用自行删除历史数据。**
- **单条记录大小禁止超过==8k==， 字段不要太多，字段的内容不易过大，超长内容需要单独存到另一张表。**
- **日志类数据不建议存储在MySQL上，优先考虑Hbase或OB**
- **为了提高查询效率，可以适当的数据冗余**
- **表被索引列必须定义为 `not null`，并设置 `default` 值**
- **禁止使用`float`、`double`类型，建议使用`decimal`或 `int` 替代。**
- **禁止使用`blob`、`text`类型保留大文本、文件、图片，建议使用其他方式存储，MySQL只保存指针信息。**
- **禁止使用 `varchar` 类型作为主键。**
